# Документация по развертыванию и использованию системы автоматизации управления контентом

## Содержание

1. [Обзор системы](#обзор-системы)
2. [Требования к системе](#требования-к-системе)
3. [Установка и настройка](#установка-и-настройка)
4. [Конфигурация](#конфигурация)
5. [Запуск системы](#запуск-системы)
6. [Использование веб-интерфейса](#использование-веб-интерфейса)
7. [Мониторинг и логирование](#мониторинг-и-логирование)
8. [Устранение неполадок](#устранение-неполадок)
9. [Часто задаваемые вопросы](#часто-задаваемые-вопросы)

## Обзор системы

Система автоматизации управления контентом представляет собой комплексное решение для автоматизированного парсинга новостей, их рерайта и публикации в различных социальных сетях (Twitter, LinkedIn, YouTube, Threads). Система состоит из трех основных компонентов:

1. **Парсер новостей** - отвечает за сбор актуальных новостей из различных источников.
2. **Система рерайта** - преобразует собранные новости в уникальный контент с учетом tone of voice для каждой социальной сети.
3. **Система автопостинга** - публикует подготовленный контент в социальных сетях с учетом их особенностей и антифрод-защиты.

## Требования к системе

### Серверные требования

- PHP 7.4 или выше
- Python 3.8 или выше
- Веб-сервер (Apache или Nginx)
- Composer
- pip (менеджер пакетов Python)
- Доступ к интернету для взаимодействия с API социальных сетей

### Зависимости PHP

- GuzzleHTTP
- phpdotenv
- monolog
- psr/log

### Зависимости Python

- beautifulsoup4
- requests
- selenium
- python-dotenv
- flask

## Установка и настройка

### Шаг 1: Клонирование репозитория

```bash
git clone https://github.com/your-repo/social_media_automation.git
cd social_media_automation
```

### Шаг 2: Установка зависимостей PHP

```bash
composer install
```

### Шаг 3: Установка зависимостей Python

```bash
pip3 install -r requirements.txt
```

### Шаг 4: Настройка окружения

Создайте файл конфигурации `.env` на основе примера:

```bash
cp config/.env.example config/.env
```

Отредактируйте файл `.env`, указав необходимые учетные данные для API социальных сетей и другие параметры.

### Шаг 5: Настройка веб-сервера

#### Apache

Создайте виртуальный хост, указывающий на директорию `public`:

```apache
<VirtualHost *:80>
    ServerName social-automation.example.com
    DocumentRoot /path/to/social_media_automation/public
    
    <Directory /path/to/social_media_automation/public>
        AllowOverride All
        Require all granted
    </Directory>
    
    ErrorLog ${APACHE_LOG_DIR}/social_automation_error.log
    CustomLog ${APACHE_LOG_DIR}/social_automation_access.log combined
</VirtualHost>
```

#### Nginx

```nginx
server {
    listen 80;
    server_name social-automation.example.com;
    root /path/to/social_media_automation/public;
    
    index index.php;
    
    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }
    
    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
        fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
    }
    
    location ~ /\.ht {
        deny all;
    }
}
```

### Шаг 6: Настройка прав доступа

```bash
chmod -R 755 .
chmod -R 777 logs
```

## Конфигурация

### Настройка API социальных сетей

В файле `.env` необходимо указать учетные данные для API каждой социальной сети:

#### Twitter

```
TWITTER_API_KEY=your_api_key
TWITTER_API_SECRET=your_api_secret
TWITTER_ACCESS_TOKEN=your_access_token
TWITTER_ACCESS_SECRET=your_access_secret
```

#### LinkedIn

```
LINKEDIN_CLIENT_ID=your_client_id
LINKEDIN_CLIENT_SECRET=your_client_secret
LINKEDIN_ACCESS_TOKEN=your_access_token
```

#### YouTube

```
YOUTUBE_API_KEY=your_api_key
YOUTUBE_CLIENT_ID=your_client_id
YOUTUBE_CLIENT_SECRET=your_client_secret
YOUTUBE_REFRESH_TOKEN=your_refresh_token
```

#### Dolphin Anty (для Threads)

```
DOLPHIN_API_URL=your_api_url
DOLPHIN_API_KEY=your_api_key
```

### Настройка источников новостей

В файле `config/sources.php` можно настроить источники новостей для парсинга:

```php
return [
    'sources' => [
        [
            'name' => 'Source 1',
            'url' => 'https://example.com/news',
            'parser' => 'Source1NewsParser'
        ],
        // Добавьте другие источники по необходимости
    ]
];
```

### Настройка шаблонов tone of voice

В файле `config/tone_of_voice.php` можно настроить шаблоны tone of voice для разных аккаунтов:

```php
return [
    'templates' => [
        'twitter_account1' => [
            'style' => 'casual',
            'prompt' => 'Перепиши новость в неформальном стиле, используя короткие предложения и эмодзи.'
        ],
        'linkedin_account1' => [
            'style' => 'professional',
            'prompt' => 'Перепиши новость в профессиональном стиле, подчеркивая бизнес-аспекты и используя деловую лексику.'
        ],
        // Добавьте другие шаблоны по необходимости
    ]
];
```

## Запуск системы

### Запуск через веб-интерфейс

После настройки веб-сервера, система доступна по указанному URL (например, http://social-automation.example.com).

### Запуск через командную строку

Для запуска автоматизации через командную строку используйте:

```bash
php cli.php automation:run --keywords="технологии,AI" --max-news=5
```

### Настройка планировщика (Cron)

Для автоматического запуска системы по расписанию, добавьте задачу в crontab:

```
# Запуск каждый час
0 * * * * cd /path/to/social_media_automation && php cli.php automation:run
```

## Использование веб-интерфейса

### Главная страница

На главной странице отображается общий статус системы и состояние аккаунтов в социальных сетях. Здесь же можно запустить процесс автоматизации, указав ключевые слова для фильтрации новостей и максимальное количество новостей для обработки.

### Страница результатов

После запуска автоматизации отображается страница с результатами, включающая:
- Количество обработанных новостей
- Количество переписанных текстов
- Количество успешных публикаций
- Процент успешных публикаций
- Детальную информацию по каждой новости

## Мониторинг и логирование

### Логи системы

Все логи системы сохраняются в директории `logs/`:
- `logs/app.log` - общие логи приложения
- `logs/parser.log` - логи парсера новостей
- `logs/rewrite.log` - логи системы рерайта
- `logs/posting.log` - логи системы автопостинга

### Мониторинг

Для мониторинга состояния системы можно использовать:
- Веб-интерфейс системы
- Проверку логов
- Запуск тестов: `python3 tests/run_tests.py`

## Устранение неполадок

### Проблемы с парсером

**Проблема**: Парсер не получает новости.
**Решение**: 
- Проверьте доступность источников новостей
- Проверьте логи парсера в `logs/parser.log`
- Убедитесь, что структура HTML на сайте-источнике не изменилась

### Проблемы с рерайтом

**Проблема**: Система рерайта не работает.
**Решение**:
- Проверьте настройки интеграции с Make.com
- Проверьте логи рерайта в `logs/rewrite.log`
- Убедитесь, что API ключи для OpenAI указаны корректно

### Проблемы с автопостингом

**Проблема**: Публикации не отправляются в социальные сети.
**Решение**:
- Проверьте статус аккаунтов через веб-интерфейс
- Проверьте логи автопостинга в `logs/posting.log`
- Убедитесь, что API ключи для социальных сетей указаны корректно и не истек срок их действия
- Проверьте, не достигнуты ли лимиты API

## Часто задаваемые вопросы

### Как добавить новый источник новостей?

1. Создайте новый класс парсера в директории `src/Parsers/`, наследующий `AbstractNewsParser`
2. Реализуйте методы `parse()` и `getNewsContent()`
3. Добавьте новый источник в конфигурацию `config/sources.php`

### Как добавить новый аккаунт социальной сети?

1. Получите API ключи для нового аккаунта
2. Добавьте их в файл `.env`
3. Добавьте инициализацию нового постера в `SocialMediaPostingManager`
4. Создайте шаблон tone of voice в `config/tone_of_voice.php`

### Как изменить частоту публикаций?

Измените настройки планировщика (Cron) для более или менее частого запуска системы.

### Как обойти ограничения API социальных сетей?

- Используйте несколько аккаунтов и чередуйте их
- Настройте задержки между публикациями в конфигурации
- Используйте прокси-серверы для доступа к API (настраивается в `.env`)
